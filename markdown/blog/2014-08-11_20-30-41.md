## 2014/08/11 20:30:41

In my last post, I mentioned the plan for a developer menu for Flare. I created [an implementation of my idea](https://www.youtube.com/watch?v=ZhLAPOs5pT8&list=UUkvFvU2eOTKylDAZOJkHfRw), but it wasn't very flexible when it came to adding functionality. It also added more than an acceptable amount of code to the MenuManager class (which is already messy). As an alternative, I started working on a [developer console](https://www.youtube.com/watch?v=hLlzxaZW8Iw&list=UUkvFvU2eOTKylDAZOJkHfRw).

![developer console screenshot](images/devconsole.png)

The end result is something that has more functionality, like being able to specify level range for "spawn_enemy". In addition, the majority of code for the developer menu resides in the MenuDevConsole class itself, as opposed to MenuManager.

I don't regret spending time on the original developer menu. During the process, I ended up looking at my 2-year-old code for WidgetListBox, which was overall poor in quality. I'm also glad that things shifted towards a developer console, since it got me to look at how to draw text items in a WidgetScrollBox. I was able to refactor out the code from MenuLog into a new WidgetLog class, which is then used in MenuLog and MenuDevConsole. Implementing new features isn't just stacking blocks on top of each other. It sometimes forces you to take a step back and look at the base of what you've built.

Moving on, I also spent a bit of time [trying to improve how targeting enemies works](https://github.com/clintbellanger/flare-engine/pull/1140). It's a common complaint we've been getting, and it's usually due to the fact that melee attacks are using aim_assist. In the context of Flare, aim_assist is used to target attacks on the ground (where the enemy hitbox actually is) when aiming at the chest of a human-sized enemy. This works for projectile attacks, since it makes the projectile fly directly through the cursor. In order to get a better idea of what was happening with targeting, I made it so that a "target" animation is drawn on the ground where the target actually is. Having such an animation makes combat feel much more solid, since it's more clear where attacks are actually landing.

The next order of business was to sort out melee attacks. Turning off aim_assist for these attacks made them work as expected with short enemies, like antlion hatchlings and goblins. However, there was still the issue of trying to attack larger enemies. If the player clicked on the head of a zombie, their attack would land above the zombie's hitbox. The solution I came up with was to implement some auto-aim for melee attacks. We already determine the enemy under the mouse cursor for MenuEnemy, so we can use the position of that enemy as the target of the melee attack.

Well, enough about Flare. I was somehow able to find time to fix an FFmpeg crash I had encountered. After updating FFmpeg from 1:2.2.5 to 1:2.3.1, SpaceFM was crashing when generating thumbnails for my episodes of Nichijou. The crash was happening because a bit of new code was trying to read Matroska chapter data even if the chapter data wasn't created (in my case, due to a broken chapter in the last episode). So a simple NULL-check did the trick. I'm now just waiting for [the patch](files/ffmpeg-patch.patch) to get reviewed on the ffmpeg-devel mailing list.

EDIT: Turns out my patch was [merged 3 days prior to this post](http://git.videolan.org/?p=ffmpeg.git;a=commit;h=87dc8b3af9135f0cfcdf3c0520e3f29e7b0d92c6), and I didn't notice since my tiny brain couldn't handle the concept of a mailing list.

